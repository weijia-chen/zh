

### 所有功能：

查看关注的问题，话题，博主，

1、问题管理：提问，删除问题，关注/取消关注问题，查看问题

2、回答管理：发布/删除回答，收藏/取消收藏回答，点赞回答。查看回答（逐个查看）。评论回答

3、评论管理：发表评论：在原响应基础上增加了一个mood属性。0代表积极，1代表消极；注意：发表成功后会将这条评论作为响应数据返回给浏览器，回显到界面上。		查看评论：在原响应基础上增加了一个mood属性；是以数组形式返回的

4、关注问题，关注用户，关注话题。取关这三个

5、登录注册，修改密码

6、热榜；

7、关注的动态（问题，用户和话题）

8、自己收到的通知（消息）

9、个人主页：所有的关注列表（问题，用户，话题）；收藏夹（浏览收藏夹中的回答）；自己发布的回答，问题；

个人的一些统计数据：收到的赞，粉丝数，关注的人数

#### 注意：

查看自己收藏的所有回答：返回回答所在问题的标题和回答的内容；实体类为ReplyVo；

收藏回答到指定收藏夹：首先用户在回答详情页点击收藏的时候，会弹出一个该用户创建的所有收藏夹（以收藏夹对象数组的形式返回，收藏夹对象中有一个属性flag标识改用户是否已经将当前回答收藏到该收藏夹中，0：未收藏，1：收藏）；用户选择好收藏夹后，发送收藏请求到后端，后端返回响应码和提示消息；



### 设计思路：

#### 1、取关博主，取关问题，取关话题。

所有的取关操作不仅要在相应的关注表删除记录，还需要把由于关注产生的消息都删除。

#### 2、删除问题，删除回答

将所有由该问题/回答产生得消息统统删除。

删除问题涉及的表：问题表，回答表，评论表，消息表（4个都要）；redis中的缓存不删，达到最终一致性即可

删除回答涉及的表：回答表，评论表。消息表（3个，除话题消息表外）；还要删除回答中的点赞表

创建触发器来级联删除较好。

#### 3、不设置逻辑删除。改为直接删除

#### 4、查看回答详情

1、回答是否被收藏。是否被点赞。答主是否被关注

#### 5 热板优化

热门问题每分钟更新一次，一次大概20条问题。

计算方式：在这一分钟内，所有被浏览过的问题，以浏览次数*0.5+关注人数进行排序得到

1、如果问题不足20个，则从最新发布的问题中取

2、一开始启动时，20个问题选取最新的

#### 问题详情模块

1.增加问题浏览量,直接异步

2.查询问题的所有信息：先查缓存

3.计算问题的实际回答数

4.远程调用：查看当前用户是否关注当前问题



#### 回答详情模块：

查询问题的第cur个回答:

```
1.先查回答，通过分页查询，回答的第n个（存在bug：回答按照时间倒序，也就是说最晚发布的回答，会排在第一个，而且是分页查询回答，假设当前查看第一页的回答id为5，再点击下一个回答之前，有其他人发布了一个回答id为6，发布成功之后，当前问题的第一页的回答就是id=6的这个回答，而id=5的回答就成了第二页，此时点击下一个回答，看到的还是id=5的回答）
1.2：修改
1）需求：上面的bug要解决，并且，在用户提交回答之后，要看到自己的回答，页数也要正确
2）解决方案：自己的永远在第一页，其他的按正常的排序，可以考虑内存分页

2.答主是否关注，远程调用

3.回答是否收藏，查询数据库

4.回答是否点赞，查询redis

5.回答的收藏数量，查询redis
```



#### 点赞

先查redis，达到倍数再写入数据库

#### 点击收藏

点击收藏时弹出用户的所有收藏夹，如果当前回答已经收藏到某个收藏夹中，那么该收藏夹就显示已收藏，参考csdn的实现

```
* 1.查询用户的所有收藏夹
* 2.查询用户关注这篇博客的所有收藏夹
* 3.在所有收藏夹中标记
```

#### 收藏数量的计算:

按收藏夹统计（应改为按用户统计）

